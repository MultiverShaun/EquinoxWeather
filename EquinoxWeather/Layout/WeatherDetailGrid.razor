@inject IRepository _repo

	<div class="detail-grid-tile hour-forecast-box">
        <_24HourForecastBox Weather="@Weather" CurrentHour="@(timeInHours)" />
	</div>

<div id="detail-grid">
    <div <!-- class="detail-grid-tile" -->
        <AdvancedInfoBox LocationTime="@(locationTime)" TimeZone="@(Weather.timezone)" PrecipitationChance="@(precipitationChance)" UvIndex="@(uvIndex)" AirPressure="@Weather.current.pressure_msl" AirPressureUnit="@Weather.current_units.pressure_msl" Humidity="@Weather.current.relative_humidity_2m" DewPoint="@dewPoint" TempUnit="@Weather.current_units.temperature_2m" CloudCover="@Weather.current.cloud_cover" Visibility="@visibility" WindSpeed="@Weather.current.wind_speed_10m" WindSpeedUnit="@Weather.current_units.wind_speed_10m" WindDirection="@Weather.current.wind_direction_10m" Sunrise="@Weather.daily.sunrise.FirstOrDefault()" Sunset="@Weather.daily.sunset.FirstOrDefault()" IsDay="@Weather.current.is_day" />
    </div>
    
    <div class="detail-grid-tile">
        <_7DayForecastBox Weather="@Weather" />
    </div>

</div>

<a class="detail-grid-tile aqi-box" href="https://www.who.int/news-room/fact-sheets/detail/ambient-(outdoor)-air-quality-and-health" target="_blank">
    <AQIBox Lat="@Lat" Lon="@Lon"/>
</a>

@code {
    [Parameter]
    public OpenMeteoResponse? Weather { get; set; }
    [Parameter]
    public IWeatherCode ?WeatherStatus { get; set; }
    [Parameter]
    public string? WeatherIcon { get; set; }
    [Parameter]
    public double Lat { get; set; }
    [Parameter]
    public double Lon { get; set; }
    private string locationTime = "";
    private int timeInHours = 0;
    private int precipitationChance = 0;
    private int uvIndex = 0;
    private int dewPoint = 0;
    private double visibility = 0.0;

    protected async override Task OnInitializedAsync()
    {
        DateTime apiTime = await _repo.GetTimeZoneInfo(Weather.timezone);
        timeInHours = apiTime.Hour;
        locationTime = apiTime.ToString("hh:mm tt");

        precipitationChance = Weather.hourly.precipitation_probability[timeInHours];
        uvIndex = Convert.ToInt32(Weather.hourly.uv_index[timeInHours]);
        dewPoint = Convert.ToInt32(Weather.hourly.dew_point_2m[timeInHours]);
        visibility = Weather.hourly.visibility[timeInHours]/1000;

    }
}